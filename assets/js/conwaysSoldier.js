class ConwaysSoldierGame{constructor(){this.boardWidth=15,this.boardHeight=14,this.shorelineRow=6,this.board=[],this.initialSetup=[],this.selectedCell=null,this.bestHeight=0,this.gameMode="setup",this.initializeBoard(),this.renderBoard(),this.setupEventListeners()}initializeBoard(){this.board=Array(this.boardHeight).fill(null).map((()=>Array(this.boardWidth).fill(!1))),this.gameMode="setup",this.updateGameModeUI()}setupInitialSoldiers(){for(let e=this.shorelineRow+1;e<this.boardHeight;e++)for(let t=2;t<this.boardWidth-2;t++)Math.random()<.8&&(this.board[e][t]=!0);for(let e=4;e<this.boardWidth-4;e++)Math.random()<.6&&(this.board[this.shorelineRow][e]=!0);const e=Math.floor(this.boardWidth/2);this.board[this.shorelineRow+1][e]=!0,this.board[this.shorelineRow+1][e-1]=!0,this.board[this.shorelineRow+1][e+1]=!0,this.board[this.shorelineRow+2][e]=!0}renderBoard(){const e=document.getElementById("gameBoard");e.innerHTML="";for(let t=0;t<this.boardHeight;t++)for(let i=0;i<this.boardWidth;i++){const s=document.createElement("div");if(s.className="cell",s.dataset.row=t,s.dataset.col=i,"setup"===this.gameMode?(s.classList.add("setup-mode"),t<this.shorelineRow&&s.classList.add("invalid-placement")):s.classList.add("playing-mode"),t===this.shorelineRow?s.classList.add("shoreline"):t>this.shorelineRow&&s.classList.add("water"),t<this.shorelineRow&&i===this.boardWidth-1){const e=document.createElement("span");e.className="height-indicator",e.textContent="+"+(this.shorelineRow-t),s.appendChild(e)}if(this.board[t][i]){const e=document.createElement("div");e.className="soldier",s.appendChild(e)}e.appendChild(s)}this.updateBestHeight()}setupEventListeners(){document.getElementById("gameBoard").addEventListener("click",(e=>this.handleCellClick(e))),document.getElementById("setupBtn").addEventListener("click",(()=>this.enterSetupMode())),document.getElementById("playBtn").addEventListener("click",(()=>this.startPlaying())),document.getElementById("resetBtn").addEventListener("click",(()=>this.resetGame()))}handleCellClick(e){const t=e.target.closest(".cell");if(!t)return;const i=parseInt(t.dataset.row),s=parseInt(t.dataset.col);"setup"===this.gameMode?this.handleSetupClick(i,s):this.handlePlayingClick(i,s)}handleSetupClick(e,t){e<this.shorelineRow||(this.board[e][t]=!this.board[e][t],this.renderBoard(),this.updateGameModeUI())}handlePlayingClick(e,t){if(document.querySelectorAll(".cell").forEach((e=>{e.classList.remove("selected","valid-move")})),this.board[e][t]){this.selectedCell={row:e,col:t};document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("selected"),this.highlightValidMoves(e,t)}else this.selectedCell&&this.isValidMove(this.selectedCell.row,this.selectedCell.col,e,t)?(this.makeMove(this.selectedCell.row,this.selectedCell.col,e,t),this.selectedCell=null):this.selectedCell=null}highlightValidMoves(e,t){[[-2,0],[2,0],[0,-2],[0,2]].forEach((([i,s])=>{const o=e+i,a=t+s;if(this.isValidMove(e,t,o,a)){const e=document.querySelector(`[data-row="${o}"][data-col="${a}"]`);e&&e.classList.add("valid-move")}}))}isValidMove(e,t,i,s){if(i<0||i>=this.boardHeight||s<0||s>=this.boardWidth)return!1;if(this.board[i][s])return!1;const o=i-e,a=s-t;if(!(2===Math.abs(o)&&0===a||2===Math.abs(a)&&0===o))return!1;const l=e+o/2,d=t+a/2;return this.board[l][d]}makeMove(e,t,i,s){const o=e+(i-e)/2,a=t+(s-t)/2,l=document.querySelector(`[data-row="${e}"][data-col="${t}"]`).querySelector(".soldier");l&&(l.classList.add("jumping"),setTimeout((()=>{this.board[e][t]=!1,this.board[o][a]=!1,this.board[i][s]=!0,this.renderBoard()}),250))}updateBestHeight(){let e=0;for(let t=0;t<this.shorelineRow;t++)for(let i=0;i<this.boardWidth;i++)if(this.board[t][i]){const i=this.shorelineRow-t;e=Math.max(e,i)}this.bestHeight=Math.max(this.bestHeight,e),document.getElementById("bestHeight").textContent=`Mejor altura: ${this.bestHeight}`,4===e&&setTimeout((()=>{alert("\ud83c\udf89 \xa1Felicidades! Has alcanzado la fila 4 - \xa1el m\xe1ximo te\xf3rico! \ud83c\udf89\n\nHas logrado el l\xedmite matem\xe1tico del problema del soldado de Conway!")}),500)}resetGame(){this.selectedCell=null,"playing"===this.gameMode&&this.initialSetup.length>0?(this.restoreInitialSetup(),this.gameMode="playing"):(this.gameMode="setup",this.initializeBoard()),this.updateGameModeUI(),this.renderBoard()}enterSetupMode(){this.gameMode="setup",this.selectedCell=null,this.initialSetup.length>0&&this.restoreInitialSetup(),this.updateGameModeUI(),this.renderBoard()}startPlaying(){this.hasSoldiers()?(this.saveInitialSetup(),this.gameMode="playing",this.selectedCell=null,this.updateGameModeUI(),this.renderBoard()):alert("\xa1Coloca algunos soldados primero!")}updateGameModeUI(){const e=document.getElementById("setupBtn"),t=document.getElementById("playBtn"),i=document.getElementById("resetBtn"),s=document.getElementById("setupInstructions");e.classList.remove("button-active"),t.classList.remove("button-active"),"setup"===this.gameMode?(e.disabled=!0,e.classList.add("button-active"),i.disabled=!0,t.disabled=!this.hasSoldiers(),s.style.display="none"):(e.disabled=!1,i.disabled=!1,t.disabled=!0,t.classList.add("button-active"),s.style.display="none")}hasSoldiers(){for(let e=0;e<this.boardHeight;e++)for(let t=0;t<this.boardWidth;t++)if(this.board[e][t])return!0;return!1}clearAllSoldiers(){this.board=Array(this.boardHeight).fill(null).map((()=>Array(this.boardWidth).fill(!1))),this.renderBoard(),this.updateGameModeUI()}saveInitialSetup(){this.initialSetup=this.board.map((e=>[...e]))}restoreInitialSetup(){this.board=this.initialSetup.map((e=>[...e]))}setOptimalSetup(){this.clearAllSoldiers();const e=Math.floor(this.boardWidth/2);[[this.shorelineRow+1,e],[this.shorelineRow+2,e-1],[this.shorelineRow+2,e],[this.shorelineRow+2,e+1],[this.shorelineRow+3,e-2],[this.shorelineRow+3,e-1],[this.shorelineRow+3,e],[this.shorelineRow+3,e+1],[this.shorelineRow+3,e+2],[this.shorelineRow+4,e-1],[this.shorelineRow+4,e],[this.shorelineRow+4,e+1],[this.shorelineRow+5,e],[this.shorelineRow+6,e],[this.shorelineRow+7,e]].forEach((([e,t])=>{e<this.boardHeight&&t>=0&&t<this.boardWidth&&(this.board[e][t]=!0)})),this.renderBoard()}}document.addEventListener("DOMContentLoaded",(()=>{window.game=new ConwaysSoldierGame,window.setOptimal=()=>{window.game.setOptimalSetup(),window.game.renderBoard()}}));