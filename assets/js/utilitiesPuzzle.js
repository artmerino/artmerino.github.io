class UtilitiesPuzzle{constructor(){this.houses=[{id:"h1",label:"Casa 1",x:50,y:80},{id:"h2",label:"Casa 2",x:50,y:180},{id:"h3",label:"Casa 3",x:50,y:280}],this.utilities=[{id:"u1",label:"\ud83d\udca7",name:"Agua",x:450,y:80},{id:"u2",label:"\u26a1",name:"Electricidad",x:450,y:180},{id:"u3",label:"\ud83d\udd25",name:"Gas",x:450,y:280}],this.connections=[],this.selectedNode=null,this.lineRadius=20,this.initializeSVG(),this.renderBoard(),this.setupEventListeners()}initializeSVG(){const e=document.getElementById("canvas");e.setAttribute("width","500"),e.setAttribute("height","360"),e.setAttribute("viewBox","0 0 500 360")}renderBoard(){document.getElementById("canvas").innerHTML="",this.connections.forEach(((e,t)=>{this.drawConnection(e,t)})),this.houses.forEach((e=>{this.drawNode(e,"house")})),this.utilities.forEach((e=>{this.drawNode(e,"utility")})),this.updateConnectionCounter()}drawNode(e,t){const i=document.getElementById("canvas"),s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("class",`${t}${this.selectedNode?.id===e.id?" selected":""}`),s.setAttribute("data-id",e.id);const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",e.x),n.setAttribute("cy",e.y),n.setAttribute("r",this.lineRadius);const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",e.x),o.setAttribute("y",e.y),o.setAttribute("fill","white"),o.textContent="utility"===t?e.label:e.label.replace("Casa ",""),s.appendChild(n),s.appendChild(o),s.addEventListener("click",(i=>this.handleNodeClick(e,t,i))),i.appendChild(s)}drawConnection(e,t){const i=document.getElementById("canvas"),s=this.getNode(e.from),n=this.getNode(e.to),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",s.x),o.setAttribute("y1",s.y),o.setAttribute("x2",n.x),o.setAttribute("y2",n.y),o.setAttribute("class","connection-line"),o.setAttribute("data-index",t),o.addEventListener("click",(e=>{e.stopPropagation(),this.removeConnection(t)})),i.appendChild(o)}getNode(e){return[...this.houses,...this.utilities].find((t=>t.id===e))}handleNodeClick(e,t,i){if(i.stopPropagation(),null===this.selectedNode)this.selectedNode=e,this.renderBoard();else if(this.selectedNode.id===e.id)this.selectedNode=null,this.renderBoard();else{const t=this.houses.find((e=>e.id===this.selectedNode.id)),i=this.utilities.find((t=>t.id===e.id)),s=this.utilities.find((e=>e.id===this.selectedNode.id)),n=this.houses.find((t=>t.id===e.id));if(t&&i||s&&n){const i=t?this.selectedNode.id:e.id,s=t?e.id:this.selectedNode.id;this.connections.some((e=>e.from===i&&e.to===s))||(this.wouldCrossingOccur(i,s)?alert("\u274c \xa1Las l\xedneas se cruzan! No puedes hacer esta conexi\xf3n."):(this.connections.push({from:i,to:s}),this.checkWin()))}this.selectedNode=null,this.renderBoard()}}wouldCrossingOccur(e,t){const i=this.getNode(e),s=this.getNode(t);for(const e of this.connections){const t=this.getNode(e.from),n=this.getNode(e.to);if(this.linesCross(i.x,i.y,s.x,s.y,t.x,t.y,n.x,n.y))return!0}return!1}linesCross(e,t,i,s,n,o,d,c){const l=(e,t,i,s,n,o)=>(o-t)*(i-e)>(s-t)*(n-e);return l(e,t,n,o,d,c)!==l(i,s,n,o,d,c)&&l(e,t,i,s,n,o)!==l(e,t,i,s,d,c)}removeConnection(e){this.connections.splice(e,1),this.renderBoard()}updateConnectionCounter(){document.getElementById("connectionCounter").textContent=`Conexiones: ${this.connections.length}/9`}checkWin(){if(9===this.connections.length){const e=9;this.connections.length===e&&(this.renderBoard(),setTimeout((()=>{alert("\ud83c\udf89 \xa1Felicidades! \ud83c\udf89\n\n\xa1Has logrado lo imposible!\n\nConectaste las 3 casas con los 3 servicios sin que se crucen las l\xedneas.\n\nEsto desaf\xeda la topolog\xeda matem\xe1tica \ud83d\ude04")}),300))}}setupEventListeners(){document.getElementById("resetBtn").addEventListener("click",(()=>this.reset()))}reset(){this.connections=[],this.selectedNode=null,this.renderBoard()}}document.addEventListener("DOMContentLoaded",(()=>{window.puzzle=new UtilitiesPuzzle}));