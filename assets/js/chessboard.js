class ChessboardPuzzle{constructor(){this.boardSize=8,this.currentBoard=1,this.selectedSquare=null,this.dominoes=[],this.boards={1:{blocked:[[1,1],[8,8]],maxDominoes:31},2:{blocked:[[1,1],[1,2]],maxDominoes:31},3:{blocked:[[4,4],[5,5]],maxDominoes:31},4:{blocked:[[1,1],[2,1]],maxDominoes:31}},this.initializeBoard(),this.setupEventListeners()}initializeBoard(){this.renderBoard(),this.updateTileCounter()}renderBoard(){const e=document.getElementById("gameBoard");e.innerHTML="";const t=this.boards[this.currentBoard].blocked;for(let s=0;s<this.boardSize;s++)for(let o=0;o<this.boardSize;o++){const i=document.createElement("div");i.className="square",i.dataset.row=s,i.dataset.col=o,(s+o)%2==0?i.classList.add("white"):i.classList.add("black");t.some((([e,t])=>e-1===s&&t-1===o))&&i.classList.add("blocked"),e.appendChild(i)}this.dominoes.forEach(((e,t)=>{this.renderDomino(e,t)}))}renderDomino(e,t){const s=document.getElementById("gameBoard"),o=s.querySelector(".square");if(!o)return;const i=o.offsetWidth,a=getComputedStyle(s),r=parseFloat(a.paddingLeft)||0,n=i-2,d=(parseFloat(a.paddingTop)||0)+e.row*n,c=r+e.col*n,l=document.createElement("div");l.className=`domino ${e.orientation}`,l.dataset.index=t,l.style.position="absolute",l.style.top=`${d}px`,l.style.left=`${c}px`,l.style.width="horizontal"===e.orientation?2*n+"px":`${n}px`,l.style.height="vertical"===e.orientation?2*n+"px":`${n}px`,l.style.zIndex="10",l.addEventListener("click",(e=>{e.stopPropagation(),this.removeDomino(t)})),s.appendChild(l);this.getDominoSquares(e).forEach((([e,t])=>{const s=document.querySelector(`[data-row="${e}"][data-col="${t}"]`);s&&s.classList.add("covered")}))}setupEventListeners(){document.getElementById("gameBoard").addEventListener("click",(e=>this.handleSquareClick(e))),document.getElementById("resetBtn").addEventListener("click",(()=>this.reset())),document.querySelectorAll(".board-btn").forEach((e=>{e.addEventListener("click",(e=>this.switchBoard(parseInt(e.target.dataset.board))))}))}handleSquareClick(e){const t=e.target.closest(".square");if(!t||t.classList.contains("blocked")||t.classList.contains("covered"))return;const s=parseInt(t.dataset.row),o=parseInt(t.dataset.col);if(null===this.selectedSquare)this.selectedSquare={row:s,col:o},t.classList.add("selected");else{const e=this.selectedSquare.row,t=this.selectedSquare.col;if(this.areAdjacent(e,t,s,o)){const i=e===s?"horizontal":"vertical",a=Math.min(e,s),r=Math.min(t,o);this.placeDomino(a,r,i)}document.querySelectorAll(".square.selected").forEach((e=>e.classList.remove("selected"))),this.selectedSquare=null}}areAdjacent(e,t,s,o){const i=Math.abs(e-s),a=Math.abs(t-o);return 1===i&&0===a||0===i&&1===a}canPlaceDomino(e,t,s){return"horizontal"===s?!(t+1>=this.boardSize)&&(!this.isSquareOccupied(e,t)&&!this.isSquareOccupied(e,t+1)):!(e+1>=this.boardSize)&&(!this.isSquareOccupied(e,t)&&!this.isSquareOccupied(e+1,t))}isSquareOccupied(e,t){const s=document.querySelector(`[data-row="${e}"][data-col="${t}"]`);return s&&(s.classList.contains("blocked")||s.classList.contains("covered"))}placeDomino(e,t,s){this.dominoes.push({row:e,col:t,orientation:s}),this.renderBoard(),this.updateTileCounter(),this.checkWin()}getDominoSquares(e){const t=[[e.row,e.col]];return"horizontal"===e.orientation?t.push([e.row,e.col+1]):t.push([e.row+1,e.col]),t}removeDomino(e){this.dominoes.splice(e,1),this.renderBoard(),this.updateTileCounter()}updateTileCounter(){const e=this.boards[this.currentBoard].maxDominoes;document.getElementById("tileCounter").textContent=`Fichas: ${this.dominoes.length}/${e}`}checkWin(){const e=this.boards[this.currentBoard].maxDominoes;this.dominoes.length===e&&setTimeout((()=>{alert(`\ud83c\udf89 \xa1Felicidades! \ud83c\udf89\n\n\xa1Has completado el tablero ${this.currentBoard}!\n\nColocaste ${this.dominoes.length} fichas de domin\xf3.`)}),300)}switchBoard(e){this.currentBoard=e,this.dominoes=[],this.selectedSquare=null,document.querySelectorAll(".board-btn").forEach((t=>{t.classList.remove("active"),parseInt(t.dataset.board)===e&&t.classList.add("active")})),this.renderBoard(),this.updateTileCounter()}reset(){this.dominoes=[],this.selectedSquare=null,document.querySelectorAll(".square.selected").forEach((e=>e.classList.remove("selected"))),this.renderBoard(),this.updateTileCounter()}}document.addEventListener("DOMContentLoaded",(()=>{window.puzzle=new ChessboardPuzzle}));