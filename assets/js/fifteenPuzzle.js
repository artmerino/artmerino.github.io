class FifteenPuzzle{constructor(){this.mode=15,this.size=4,this.tiles=[],this.emptyPos={row:3,col:3},this.moves=0,this.isShuffled=!1,this.initializeBoard(),this.renderBoard(),this.setupEventListeners()}initializeBoard(){this.size=8===this.mode?3:4,this.tiles=[];let t=1;this.mode;for(let e=0;e<this.size;e++){this.tiles[e]=[];for(let s=0;s<this.size;s++)e===this.size-1&&s===this.size-1?this.tiles[e][s]=0:this.tiles[e][s]=t++}this.emptyPos={row:this.size-1,col:this.size-1}}renderBoard(){const t=document.getElementById("gameBoard");t.innerHTML="";let e=100;const s=window.innerWidth;if(s<=480){const t=Math.min(s-32,280);e=Math.floor((t-2*(this.size-1))/this.size),e=Math.max(e,40)}else if(s<=768){const t=Math.min(s-24,360);e=Math.floor((t-3*(this.size-1))/this.size),e=Math.max(e,55)}t.style.gridTemplateColumns=`repeat(${this.size}, ${e}px)`,t.style.gridTemplateRows=`repeat(${this.size}, ${e}px)`,t.style.setProperty("--tile-size",`${e}px`);for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){const i=document.createElement("div");i.className="tile",i.dataset.row=e,i.dataset.col=s;const o=this.tiles[e][s];0===o?i.classList.add("empty"):(i.textContent=o,this.canMove(e,s)&&i.classList.add("movable")),t.appendChild(i)}this.updateMoveCounter(),this.checkWin()}setupEventListeners(){const t=document.getElementById("gameBoard");t.addEventListener("click",(t=>this.handleTileClick(t))),t.addEventListener("touchend",(t=>{t.preventDefault(),this.handleTileClick(t)})),document.getElementById("shuffleBtn").addEventListener("click",(()=>this.shuffle())),document.getElementById("impossibleBtn").addEventListener("click",(()=>this.setImpossible())),document.getElementById("modeToggle").addEventListener("click",(()=>this.toggleMode()))}toggleMode(){this.mode=15===this.mode?8:15,document.getElementById("modeToggle").textContent=`Modo: ${this.mode}`,document.getElementById("impossibleBtn").textContent=8===this.mode?"7-8":"14-15",this.moves=0,this.isShuffled=!1,this.initializeBoard(),this.renderBoard()}handleTileClick(t){const e=t.target.closest(".tile");if(!e||e.classList.contains("empty"))return;const s=parseInt(e.dataset.row),i=parseInt(e.dataset.col);this.canMove(s,i)&&this.moveTile(s,i)}canMove(t,e){const s=Math.abs(t-this.emptyPos.row),i=Math.abs(e-this.emptyPos.col);return 1===s&&0===i||0===s&&1===i}moveTile(t,e){this.canMove(t,e)&&(this.tiles[this.emptyPos.row][this.emptyPos.col]=this.tiles[t][e],this.tiles[t][e]=0,this.emptyPos={row:t,col:e},this.moves++,this.renderBoard())}shuffle(){this.initializeBoard(),this.moves=0,this.isShuffled=!1;const t=100+Math.floor(100*Math.random());for(let e=0;e<t;e++){const t=this.getMovableTiles(),e=t[Math.floor(Math.random()*t.length)];this.tiles[this.emptyPos.row][this.emptyPos.col]=this.tiles[e.row][e.col],this.tiles[e.row][e.col]=0,this.emptyPos={row:e.row,col:e.col}}this.moves=0,this.isShuffled=!0,this.renderBoard()}getMovableTiles(){const t=[],e=[[-1,0],[1,0],[0,-1],[0,1]];for(const[s,i]of e){const e=this.emptyPos.row+s,o=this.emptyPos.col+i;e>=0&&e<this.size&&o>=0&&o<this.size&&t.push({row:e,col:o})}return t}isSolved(){let t=1;for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){if(e===this.size-1&&s===this.size-1)return 0===this.tiles[e][s];if(this.tiles[e][s]!==t)return!1;t++}return!0}checkWin(){this.isSolved()&&this.isShuffled&&setTimeout((()=>{alert(`\ud83c\udf89 \xa1Felicidades! \ud83c\udf89\n\n\xa1Has resuelto el puzzle!\n\nMovimientos: ${this.moves}`)}),300)}updateMoveCounter(){document.getElementById("moveCounter").textContent=`Movimientos: ${this.moves}`}setImpossible(){this.initializeBoard(),this.moves=0,this.isShuffled=!1;const t=8===this.mode?8:15,e=t-1;let s=1;for(let i=0;i<this.size;i++)for(let o=0;o<this.size;o++)i===this.size-1&&o===this.size-1?this.tiles[i][o]=0:i===this.size-1&&o===this.size-3?this.tiles[i][o]=t:i===this.size-1&&o===this.size-2?this.tiles[i][o]=e:this.tiles[i][o]=s++;this.emptyPos={row:this.size-1,col:this.size-1},this.moves=0,this.isShuffled=!0,this.renderBoard()}}document.addEventListener("DOMContentLoaded",(()=>{window.puzzle=new FifteenPuzzle}));