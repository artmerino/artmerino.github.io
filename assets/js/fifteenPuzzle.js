class FifteenPuzzle{constructor(){this.size=4,this.tiles=[],this.emptyPos={row:3,col:3},this.moves=0,this.isShuffled=!1,this.timer=0,this.timerInterval=null,this.initializeBoard(),this.renderBoard(),this.setupEventListeners()}initializeBoard(){this.tiles=[];let t=1;for(let e=0;e<this.size;e++){this.tiles[e]=[];for(let s=0;s<this.size;s++)e===this.size-1&&s===this.size-1?this.tiles[e][s]=0:this.tiles[e][s]=t++}this.emptyPos={row:this.size-1,col:this.size-1}}renderBoard(){const t=document.getElementById("gameBoard");t.innerHTML="";for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){const i=document.createElement("div");i.className="tile",i.dataset.row=e,i.dataset.col=s;const o=this.tiles[e][s];0===o?i.classList.add("empty"):(i.textContent=o,this.canMove(e,s)&&i.classList.add("movable")),t.appendChild(i)}this.updateMoveCounter(),this.checkWin()}setupEventListeners(){const t=document.getElementById("gameBoard");t.addEventListener("click",(t=>this.handleTileClick(t))),t.addEventListener("touchend",(t=>{t.preventDefault(),this.handleTileClick(t)})),document.getElementById("shuffleBtn").addEventListener("click",(()=>this.shuffle())),document.getElementById("impossibleBtn").addEventListener("click",(()=>this.setImpossible()))}handleTileClick(t){const e=t.target.closest(".tile");if(!e||e.classList.contains("empty"))return;const s=parseInt(e.dataset.row),i=parseInt(e.dataset.col);this.canMove(s,i)&&this.moveTile(s,i)}canMove(t,e){const s=Math.abs(t-this.emptyPos.row),i=Math.abs(e-this.emptyPos.col);return 1===s&&0===i||0===s&&1===i}moveTile(t,e){this.canMove(t,e)&&(0===this.moves&&this.isShuffled&&this.startTimer(),this.tiles[this.emptyPos.row][this.emptyPos.col]=this.tiles[t][e],this.tiles[t][e]=0,this.emptyPos={row:t,col:e},this.moves++,this.renderBoard())}shuffle(){this.initializeBoard(),this.moves=0,this.isShuffled=!1,this.stopTimer();const t=100+Math.floor(100*Math.random());for(let e=0;e<t;e++){const t=this.getMovableTiles(),e=t[Math.floor(Math.random()*t.length)];this.tiles[this.emptyPos.row][this.emptyPos.col]=this.tiles[e.row][e.col],this.tiles[e.row][e.col]=0,this.emptyPos={row:e.row,col:e.col}}this.moves=0,this.isShuffled=!0,this.renderBoard()}getMovableTiles(){const t=[],e=[[-1,0],[1,0],[0,-1],[0,1]];for(const[s,i]of e){const e=this.emptyPos.row+s,o=this.emptyPos.col+i;e>=0&&e<this.size&&o>=0&&o<this.size&&t.push({row:e,col:o})}return t}isSolved(){let t=1;for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){if(e===this.size-1&&s===this.size-1)return 0===this.tiles[e][s];if(this.tiles[e][s]!==t)return!1;t++}return!0}checkWin(){this.isSolved()&&this.isShuffled&&(this.stopTimer(),setTimeout((()=>{const t=Math.floor(this.timer/60),e=this.timer%60;alert(`\ud83c\udf89 \xa1Felicidades! \ud83c\udf89\n\n\xa1Has resuelto el puzzle!\n\nMovimientos: ${this.moves}\nTiempo: ${t}:${e.toString().padStart(2,"0")}`)}),300))}updateMoveCounter(){document.getElementById("moveCounter").textContent=`Movimientos: ${this.moves}`}startTimer(){this.timer=0,this.updateTimer(),this.timerInterval=setInterval((()=>{this.timer++,this.updateTimer()}),1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}updateTimer(){const t=Math.floor(this.timer/60),e=this.timer%60;document.getElementById("timer").textContent=`Tiempo: ${t}:${e.toString().padStart(2,"0")}`}setImpossible(){this.initializeBoard(),this.moves=0,this.isShuffled=!1,this.stopTimer();let t=1;for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)e===this.size-1&&s===this.size-1?this.tiles[e][s]=0:e===this.size-1&&s===this.size-3?this.tiles[e][s]=15:e===this.size-1&&s===this.size-2?this.tiles[e][s]=14:this.tiles[e][s]=t++;this.emptyPos={row:this.size-1,col:this.size-1},this.moves=0,this.isShuffled=!0,this.renderBoard()}}document.addEventListener("DOMContentLoaded",(()=>{window.puzzle=new FifteenPuzzle}));